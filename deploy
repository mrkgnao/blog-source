#!/bin/bash

set -euo pipefail

SHORT_COMMIT=$(git show | head -1 | cut -d' ' -f2)
DIST_DIR=/tmp/blog-deploy

rm -rf $DIST_DIR

stack build --jobs 1 --fast
stack exec build-site -- -o $DIST_DIR

cd $DIST_DIR

git init

git remote add origin git@github.com:mrkgnao/mrkgnao.github.io.git
git add .
git commit -q -m "Autogenerated from $SHORT_COMMIT at $(date)"

git push -u origin master --force
